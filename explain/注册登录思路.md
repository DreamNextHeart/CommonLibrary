## 注册登录思路

> 手机号码作为登陆账号，用户名是用户在使用界面的名字

### 登录

#### 后端

1. 前端表单
   - 手机号码
   - 密码
   - 验证码
   - 记住密码
2. 前端检验规则
   - 表单均不为空
   - 手机号码为11位数字
   - 
3. 后端接收前端表单
   - 判断验证码是否正确
   - 获取前端手机号码
   - 数据库查找手机号码是否存在
   - 获取前端密码，与手机号码盐值进行拼接后使用md5加密
   - 加密密码与数据库账号密码对比是否相等
   - 用户登录后将用户信息和token信息存到redis
   - 访问权限认证模块获取权限列表
   - 返回token和权限列表给前端
   - 如果勾选了记住密码，把用户信息、token、记住密码存到cookie
   - 权限列表作为动态路由的数据，在前端不保存
   - 刷新页面后把用户信息+随机密码+记住密码同步到表单，

#### 前端

- cookie

  cookie存放user手机号码+token作为一一对应的信息，当用户选择记住密码后点击登录，选择记住密码和没选择记住密码是调用不同的接口代码，判断cookie内remember的值

  - 记住密码
  
    前端从cookie获取手机号码，token，记住密码三个同步到登陆表单内，密码可随机生成，调用验证token有效期的时间，有效期时间没过就直接登录成功
  
  - 不记住密码
  
    前端把cookie的记住密码（false）同步到登陆表单，调用正常登录接口
  
- 刷新，进入登陆注册页面

  - 判断cookie内容，remember是否为true
  - true
    - 获取cookie的token，remember，手机号码，同步到表单
    - 表单密码随机生成
    - 验证码false
    - 点击登陆后，后端采用检验token有效期的形式进行验证
  - false
    - 前端提交表单到后端验证，表单包括用户名，密码，验证码，是否记住密码
    - 后端获取前端表单的验证码，判断验证码是否正确
    - 后端获取前端表单的用户名，确认数据库是否存在该用户
    - 后端获取前端表单的密码，获取数据库对应用户的盐值，密码在前，盐值在后
    - 将拼接的字符串使用MD5加密后与数据库用户的密码进行对比，验证密码是否正确
    - 登录用户，生成token，将这两个信息存到redis
    - 返回用户名，token，权限列表到前端
    - 权限列表用于动态路由，token用户验证用户信息
    - 记住密码
      - cookie保存用户名，token，记住密码
    - 不记住密码
      - cookie保存用户名，token


- 当本来选择记住密码后刷新进入登陆页面
  - 从cookie获取username，token，记住密码
  - 点击登录
  - 后端验证username和token
  - 通过即完成登录

### 注册

#### 后端

- 前端表单
  - 用户名——这个是用户的名字，username
  - 手机号码——这个是用户名，用户登陆的账号
  - 密码
  - 确认密码
  - 邮箱
- 后端接收前端表单
  - 数据内容检验，各字段不允许为空
  - 密码和确认密码需要保证相等
  - 默认角色为user，部门为新人部
  - 
